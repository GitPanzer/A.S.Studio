<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.S. Studio - Barber√≠a Profesional</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Variables de tema oscuro */
        :root {
            --primary: #d4af37;
            --primary-dark: #b8941f;
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #f5f5f5;
            --gray: #2a2a2a;
            --gray-light: #3a3a3a;
            --success: #4caf50;
            --error: #f44336;
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        /* Reset y estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 100px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header y navegaci√≥n */
        header {
            background-color: var(--darker);
            padding: 20px 0;
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo i {
            color: var(--primary);
            font-size: 2.5rem;
        }

        .logo h1 {
            font-size: 2.5rem;
            color: var(--primary);
            letter-spacing: 2px;
        }

        .tagline {
            text-align: center;
            color: #aaa;
            font-style: italic;
            margin-top: 5px;
        }

        /* Navegaci√≥n entre p√°ginas */
        .page-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .page-btn {
            background-color: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 10px 25px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }

        .page-btn:hover,
        .page-btn.active {
            background-color: var(--primary);
            color: var(--dark);
        }

        /* Secciones generales */
        section {
            padding: 40px 0;
            border-bottom: 1px solid var(--gray);
        }

        .section-title {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 25px;
            text-align: center;
            position: relative;
        }

        .section-title:after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background-color: var(--primary);
            margin: 10px auto;
        }

        /* Bienvenida */
        .welcome {
            text-align: center;
            padding: 60px 0;
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), url('https://images.unsplash.com/photo-1585747860715-2ba37e788b70?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1174&q=80') center/cover no-repeat;
            border-radius: var(--border-radius);
            margin: 30px 0;
        }

        .welcome h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .welcome p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            color: #ddd;
        }

        .btn {
            display: inline-block;
            background-color: var(--primary);
            color: var(--dark);
            padding: 12px 30px;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
        }

        .btn:disabled {
            background-color: var(--gray-light);
            cursor: not-allowed;
            transform: none;
        }

        /* Informaci√≥n de contacto */
        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-card {
            background-color: var(--gray);
            padding: 25px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary);
        }

        .info-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .contact-link {
            color: var(--light);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .contact-link:hover {
            color: var(--primary);
        }

        .contact-link.whatsapp:hover {
            color: #25D366;
        }

        .contact-link.instagram:hover {
            color: #E4405F;
        }

        .barbero-description {
            background-color: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            border-left: 3px solid var(--primary);
        }

        /* Calendario y horarios */
        .calendar-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: space-between;
        }

        .calendar-container {
            flex: 1;
            min-width: 300px;
        }

        .hours-container {
            flex: 1;
            min-width: 300px;
            background-color: var(--gray);
            padding: 25px;
            border-radius: var(--border-radius);
        }

        .calendar {
            background-color: var(--gray);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--primary);
            color: var(--dark);
            padding: 15px;
            font-weight: bold;
        }

        .calendar-days,
        .calendar-dates {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: var(--gray-light);
        }

        .calendar-day {
            padding: 15px;
            text-align: center;
            background-color: var(--gray);
            font-weight: bold;
        }

        .calendar-date {
            padding: 15px;
            text-align: center;
            background-color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-date:hover {
            background-color: var(--gray-light);
        }

        .calendar-date.selected {
            background-color: var(--primary);
            color: var(--dark);
            font-weight: bold;
        }

        .calendar-date.disabled {
            background-color: var(--darker);
            color: #666;
            cursor: not-allowed;
        }

        .hours-list {
            margin-top: 20px;
        }

        .hour-option {
            display: inline-block;
            padding: 10px 15px;
            background-color: var(--dark);
            margin: 5px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--gray-light);
        }

        .hour-option:hover {
            border-color: var(--primary);
        }

        .hour-option.selected {
            background-color: var(--primary);
            color: var(--dark);
            font-weight: bold;
        }

        .hour-option.disabled {
            background-color: var(--darker);
            color: #666;
            cursor: not-allowed;
            border-color: var(--darker);
        }

        /* Servicios y precios (m√°s peque√±o) */
        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        .service-card {
            background-color: var(--gray);
            padding: 20px;
            border-radius: var(--border-radius);
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .service-card:hover {
            border-color: var(--primary);
        }

        .service-name {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .service-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--light);
        }

        /* Formulario de reserva */
        .reservation-form {
            background-color: var(--gray);
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: var(--dark);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            color: var(--light);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
            min-width: 250px;
        }

        .reservation-summary {
            background-color: var(--dark);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }

        /* Modal de confirmaci√≥n */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background-color: var(--gray);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .modal-info {
            margin-bottom: 15px;
        }

        .modal-info strong {
            color: var(--primary);
            display: inline-block;
            width: 120px;
        }

        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            text-decoration: none;
            display: block;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            transition: var(--transition);
        }

        .whatsapp-btn:hover {
            background-color: #1da851;
        }

        .copy-btn {
            background-color: var(--dark);
            color: var(--light);
            border: 1px solid var(--gray-light);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
            justify-content: center;
        }

        .copy-btn:hover {
            border-color: var(--primary);
        }

        .close-btn {
            background-color: transparent;
            color: var(--light);
            border: 1px solid var(--gray-light);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: var(--transition);
        }

        .close-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Reportar problemas */
        .report-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--darker);
            padding: 15px;
            border-top: 1px solid var(--gray);
            z-index: 1000;
        }

        .report-toggle {
            background-color: var(--primary);
            color: var(--dark);
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .report-form {
            max-width: 500px;
            margin: 20px auto 0;
            background-color: var(--gray);
            padding: 20px;
            border-radius: var(--border-radius);
            display: none;
        }

        .report-form.active {
            display: block;
        }

        .capture-btn {
            background-color: var(--dark);
            color: var(--light);
            border: 1px solid var(--gray-light);
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        /* Notificaciones */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: bold;
            z-index: 10000;
            display: none;
            animation: slideIn 0.5s ease;
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: var(--error);
        }

        .notification.info {
            background-color: var(--primary);
            color: var(--dark);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Control de visibilidad de p√°ginas */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Cargando */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo h1 {
                font-size: 2rem;
            }

            .welcome h2 {
                font-size: 1.8rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .calendar-section {
                flex-direction: column;
            }

            .info-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Header con logo -->
    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-cut"></i>
                <h1>A.S. Studio</h1>
            </div>
            <p class="tagline">Barber√≠a profesional - Un √∫nico barbero, m√°xima atenci√≥n</p>

            <!-- Navegaci√≥n entre p√°ginas -->
            <div class="page-nav">
                <button class="page-btn active" id="btnMainPage">
                    <i class="fas fa-home"></i> P√°gina Principal
                </button>
                <button class="page-btn" id="btnReservationPage">
                    <i class="fas fa-calendar-alt"></i> Reservar Turno
                </button>
            </div>
        </div>
    </header>
    

    <!-- P√°gina Principal -->
    <main class="container">
        <div id="mainPage" class="page active">
            <!-- Secci√≥n de bienvenida -->
            <section class="welcome">
                <h2>Bienvenido a A.S. Studio</h2>
                <p>Experimenta el arte de la barber√≠a tradicional con un toque moderno. Reserva tu turno para recibir un
                    servicio personalizado de la m√°s alta calidad.</p>
                <button class="btn" id="goToReservationBtn">
                    <i class="fas fa-calendar-alt"></i> Reservar Turno
                </button>
            </section>

            <!-- Servicios y precios (m√°s peque√±o) -->
            <section id="services">
                <h2 class="section-title">Servicios y Precios</h2>
                <div class="services">
                    <div class="service-card">
                        <h3 class="service-name">Corte de Cabello</h3>
                        <p>Corte tradicional o moderno seg√∫n tu preferencia.</p>
                        <p class="service-price">$2.500</p>
                    </div>
                    <div class="service-card">
                        <h3 class="service-name">Corte + Barba</h3>
                        <p>Corte de cabello m√°s arreglo de barba.</p>
                        <p class="service-price">$3.200</p>
                    </div>
                    <div class="service-card">
                        <h3 class="service-name">Arreglo de Barba</h3>
                        <p>Modelado, recorte y acabado de barba.</p>
                        <p class="service-price">$1.800</p>
                    </div>
                    <div class="service-card">
                        <h3 class="service-name">Afeitado Cl√°sico</h3>
                        <p>Afeitado tradicional con navaja y toallas calientes.</p>
                        <p class="service-price">$2.200</p>
                    </div>
                </div>
            </section>

            <!-- Informaci√≥n de contacto -->
            <section id="info">
                <h2 class="section-title">Informaci√≥n de Contacto</h2>
                <div class="info-cards">
                    <div class="info-card">
                        <h3><i class="fas fa-map-marker-alt"></i> Direcci√≥n</h3>
                        <a href="https://maps.google.com/?q=Av.+Principal+1234,+Local+5,+Barrio+Centro,+Ciudad"
                            target="_blank" class="contact-link">
                            <i class="fas fa-external-link-alt"></i> Av. Principal 1234, Local 5<br>Barrio Centro,
                            Ciudad
                        </a>
                        <p>Haz clic para ver en Google Maps</p>
                    </div>
                    <div class="info-card">
                        <h3><i class="fas fa-clock"></i> Horario de Atenci√≥n</h3>
                        <p>Lunes a Viernes: 9:00 - 19:00<br>S√°bados: 10:00 - 16:00<br>Domingos: Cerrado</p>
                        <button class="btn" id="goToCalendarBtn" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-calendar-day"></i> Ver Calendario
                        </button>
                    </div>
                    <div class="info-card">
                        <h3><i class="fas fa-phone-alt"></i> Contacto</h3>
                        <a href="https://wa.me/54911155739203" target="_blank" class="contact-link whatsapp">
                            <i class="fab fa-whatsapp"></i> +54 91 1557 39203
                        </a>
                        <a href="https://instagram.com/asstudiobarber" target="_blank" class="contact-link instagram">
                            <i class="fab fa-instagram"></i> @asstudiobarber
                        </a>
                        <div class="barbero-description">
                            <p><strong>Alexis</strong>, tu barbero profesional.</p>
                            <p>"Cada corte es una obra de arte. Espero tu visita para crear el estilo perfecto para ti."
                            </p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- P√°gina de Reserva -->
        <div id="reservationPage" class="page">
            <!-- Calendario y horarios -->
            <section id="schedule">
                <h2 class="section-title">Selecciona Fecha y Hora</h2>
                <div class="calendar-section">
                    <div class="calendar-container">
                        <div class="calendar">
                            <div class="calendar-header">
                                <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                                <h3 id="currentMonth">Enero 2026</h3>
                                <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-days">
                                <div class="calendar-day">Dom</div>
                                <div class="calendar-day">Lun</div>
                                <div class="calendar-day">Mar</div>
                                <div class="calendar-day">Mi√©</div>
                                <div class="calendar-day">Jue</div>
                                <div class="calendar-day">Vie</div>
                                <div class="calendar-day">S√°b</div>
                            </div>
                            <div class="calendar-dates" id="calendarDates">
                                <!-- Los d√≠as se generar√°n con JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="hours-container">
                        <h3>Horarios disponibles</h3>
                        <p id="selectedDateText">Selecciona una fecha en el calendario</p>
                        <div class="hours-list" id="hoursList">
                            <!-- Los horarios se generar√°n con JavaScript -->
                        </div>
                        <div class="info-card" style="margin-top: 20px;">
                            <h3><i class="fas fa-info-circle"></i> Importante</h3>
                            <p>No se pueden reservar dos turnos en el mismo d√≠a y horario. Cada cita tiene una duraci√≥n
                                aproximada de 30-45 minutos.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Formulario de reserva -->
            <section id="reservation">
                <h2 class="section-title">Reserva tu Turno</h2>
                <div class="reservation-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientName">Nombre / Apodo *</label>
                            <input type="text" id="clientName" class="form-control"
                                placeholder="Ej: Juan o 'El Guille'">
                        </div>
                        <div class="form-group">
                            <label for="clientWhatsApp">N√∫mero de WhatsApp *</label>
                            <input type="tel" id="clientWhatsApp" class="form-control"
                                placeholder="Ej: +54 11 1234 ‚Äî 5678">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="serviceSelect">Servicio *</label>
                        <select id="serviceSelect" class="form-control">
                            <option value="">Selecciona un servicio</option>
                            <option value="Corte de Cabello">Corte de Cabello - $2.500</option>
                            <option value="Corte + Barba">Corte + Barba - $3.200</option>
                            <option value="Arreglo de Barba">Arreglo de Barba - $1.800</option>
                            <option value="Afeitado Cl√°sico">Afeitado Cl√°sico - $2.200</option>
                        </select>
                    </div>

                    <div class="reservation-summary">
                        <h3>Resumen de tu Reserva</h3>
                        <p><strong>Fecha:</strong> <span id="summaryDate">No seleccionada</span></p>
                        <p><strong>Hora:</strong> <span id="summaryTime">No seleccionada</span></p>
                        <p><strong>Servicio:</strong> <span id="summaryService">No seleccionado</span></p>
                        <p><strong>Total:</strong> <span id="summaryPrice">$0</span></p>
                    </div>

                    <div class="form-group">
                        <p style="color: #aaa; font-size: 0.9rem; margin-top: 20px;">
                            * Al confirmar la reserva, deber√°s enviar un mensaje al barbero por WhatsApp para confirmar
                            tu turno.
                        </p>
                    </div>

                    <button class="btn" id="confirmReservationBtn"
                        style="width: 100%; padding: 15px; font-size: 1.1rem;">
                        <i class="fas fa-check-circle"></i> <span id="confirmText">Confirmar Reserva</span>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal de confirmaci√≥n -->
    <div class="modal-overlay" id="confirmationModal">
        <div class="modal">
            <h2>¬°Reserva casi lista!</h2>
            <p style="text-align: center; margin-bottom: 20px;">Ahora env√≠a la confirmaci√≥n al barbero por WhatsApp</p>

            <div class="modal-section">
                <div class="modal-info">
                    <strong>T√∫:</strong> <span id="modalClientName">krm</span>
                </div>
                <div class="modal-info">
                    <strong>Tu WhatsApp:</strong> <span id="modalWhatsApp">11232423</span>
                </div>
                <div class="modal-info">
                    <strong>Fecha:</strong> <span id="modalDate">viernes, 23 de enero de 2026</span>
                </div>
                <div class="modal-info">
                    <strong>Hora:</strong> <span id="modalTime">09:30</span>
                </div>
                <div class="modal-info">
                    <strong>Servicio:</strong> <span id="modalService">Corte de Cabello</span>
                </div>
                <div class="modal-info">
                    <strong>Total:</strong> <span id="modalPrice">$2.500</span>
                </div>
                <div class="modal-info">
                    <strong>Estado:</strong> <span id="modalStatus">Pendiente de confirmaci√≥n</span>
                </div>
            </div>

            <div class="modal-section">
                <p>El barbero te confirmar√° la disponibilidad por WhatsApp</p>
                <p style="margin-top: 10px;"><strong>Barbero:</strong> +54 91 1557 39203</p>
            </div>

            <div class="modal-section">
                <h3>Enviar Confirmaci√≥n al Barbero</h3>
                <button class="copy-btn" id="copyMessageBtn">
                    <i class="far fa-copy"></i> Copiar Mensaje
                </button>
                <a href="#" target="_blank" class="whatsapp-btn" id="whatsappLink">
                    <i class="fab fa-whatsapp"></i> Abrir WhatsApp para Enviar
                </a>
            </div>

            <button class="close-btn" id="closeModalBtn">
                Cerrar (Ya envi√© el mensaje)
            </button>
        </div>
    </div>

    <!-- Secci√≥n para reportar problemas -->
    <footer class="report-section">
        <button class="report-toggle" id="toggleReport">
            <i class="fas fa-exclamation-triangle"></i> Reportar un Problema
        </button>

        <div class="report-form" id="reportForm">
            <div class="form-group">
                <label for="problemDescription">Describe el problema *</label>
                <textarea id="problemDescription" class="form-control" rows="3"
                    placeholder="Detalla el problema que encontraste..."></textarea>
            </div>

            <button class="capture-btn" id="captureScreen">
                <i class="fas fa-camera"></i> Capturar Pantalla
            </button>

            <button class="btn" id="sendReport" style="margin-top: 15px; width: 100%;">
                <i class="fas fa-paper-plane"></i> Enviar Reporte
            </button>
        </div>
    </footer>

    <!-- Notificaci√≥n -->
    <div class="notification" id="notification"></div>

    <script>

        // Al inicio del script, agregar compatibilidad
if (!document.execCommand && navigator.clipboard) {
    document.execCommand = function(command, showUI, value) {
        if (command === 'copy' && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(value).then(() => true);
            return true;
        }
        return false;
    };
}

    // ========== CONFIGURACI√ìN SUPABASE ==========
    const SUPABASE_URL = 'https://wumhmurhneptjeptqmwo.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_KR_jOgno55j-XPV8fCgscA_ct5PYYou';

    // Variables globales
    let selectedDate = null;
    let selectedTime = null;
    let selectedService = null;
    let bookedSlots = {};
    let isSaving = false;
    let currentMonth, currentYear;
    let supabaseClient = null;

    // Precios de servicios
    let servicePrices = {
        'Corte de Cabello': 2500,
        'Corte + Barba': 3200,
        'Arreglo de Barba': 1800,
        'Afeitado Cl√°sico': 2200
    };

    // Cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', function () {
        console.log('DOM cargado');
        initializeSupabase();
        initCalendar();
        setupEventListeners();
    });

    // Inicializar Supabase
  // REEMPLAZA tu inicializaci√≥n de Supabase con esto:
supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    auth: {
        autoRefreshToken: false,
        persistSession: false,
        detectSessionInUrl: false
    },
    db: {
        schema: 'public'
    },
    global: {
        headers: {
            'Prefer': 'return=representation'  // Esto es importante
        }
    },
    realtime: {
        params: {
            eventsPerSecond: 10
        }
    }
});

    // Cargar datos
    async function loadDataFromSupabase() {
        try {
            await Promise.all([
                loadServiciosFromSupabase(),
                loadBookedSlotsFromSupabase(),
                loadAgendaConfigFromSupabase()
            ]);
            console.log('Datos cargados');
            updateAvailableHours();
        } catch (error) {
            console.error('Error cargando datos:', error);
        }
    }

    // Cargar servicios
    async function loadServiciosFromSupabase() {
        if (!supabaseClient) return;

        try {
            const { data, error } = await supabaseClient
                .from('servicios')
                .select('*')
                .order('precio', { ascending: true });

            if (error) throw error;

            if (data && data.length > 0) {
                servicePrices = {};
                data.forEach(servicio => {
                    servicePrices[servicio.nombre] = servicio.precio;
                });

                const serviceSelect = document.getElementById('serviceSelect');
                if (serviceSelect) {
                    serviceSelect.innerHTML = '<option value="">Selecciona un servicio</option>';
                    data.forEach(servicio => {
                        const option = document.createElement('option');
                        option.value = servicio.nombre;
                        option.textContent = `${servicio.nombre} - $${servicio.precio.toLocaleString('es-AR')}`;
                        serviceSelect.appendChild(option);
                    });
                }

                const servicesSection = document.querySelector('.services');
                if (servicesSection) {
                    servicesSection.innerHTML = '';
                    data.forEach(servicio => {
                        const serviceCard = document.createElement('div');
                        serviceCard.className = 'service-card';
                        serviceCard.innerHTML = `
                            <h3 class="service-name">${servicio.nombre}</h3>
                            <p>${servicio.descripcion || 'Servicio profesional'}</p>
                            <p class="service-price">$${servicio.precio.toLocaleString('es-AR')}</p>
                        `;
                        servicesSection.appendChild(serviceCard);
                    });
                }
            }
        } catch (error) {
            console.error('Error servicios:', error);
        }
    }

    // Cargar agenda
  // VERSI√ìN CORREGIDA - loadAgendaConfigFromSupabase
async function loadAgendaConfigFromSupabase() {
    if (!supabaseClient) {
        console.log('Sin cliente Supabase para agenda');
        return;
    }

    try {
        const hoy = new Date();
        hoy.setHours(0, 0, 0, 0);
        
        const mesSiguiente = new Date();
        mesSiguiente.setDate(hoy.getDate() + 60);
        mesSiguiente.setHours(23, 59, 59, 999);

        console.log('Cargando agenda desde:', formatDate(hoy), 'hasta:', formatDate(mesSiguiente));

        // Formatear fechas para consulta
        const fechaDesde = formatDate(hoy);
        const fechaHasta = formatDate(mesSiguiente);

        console.log('Consultando agenda con fechas:', { fechaDesde, fechaHasta });

        // Consulta SIMPLIFICADA y CORREGIDA
        const { data, error } = await supabaseClient
            .from('horarios_agenda')
            .select('fecha, activo')
            .gte('fecha', fechaDesde)
            .lte('fecha', fechaHasta);

        if (error) {
            console.error('‚ùå Error cargando agenda:', error);
            console.error('Detalles error:', {
                message: error.message,
                code: error.code,
                details: error.details,
                hint: error.hint
            });
            return;
        }

        console.log('‚úÖ Datos de agenda cargados:', data ? data.length : 0, 'registros');

        if (data && data.length > 0) {
            console.log('Primeros 3 registros de agenda:', data.slice(0, 3));
            
            data.forEach(item => {
                if (item.fecha && item.activo === false) {
                    const fechaKey = item.fecha;
                    console.log('üîí D√≠a bloqueado en agenda:', fechaKey);
                    
                    // Inicializar array si no existe
                    if (!bookedSlots[fechaKey]) {
                        bookedSlots[fechaKey] = [];
                    }
                    
                    // Bloquear horarios t√≠picos (9:00-18:00)
                    const horariosCompletos = [
                        '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
                        '12:00', '12:30', '13:00', '13:30', '14:00', '14:30',
                        '15:00', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00'
                    ];
                    
                    horariosCompletos.forEach(hora => {
                        if (!bookedSlots[fechaKey].includes(hora)) {
                            bookedSlots[fechaKey].push(hora);
                        }
                    });
                }
            });
        } else {
            console.log('üì≠ No se encontraron registros en la agenda para el rango solicitado');
        }

    } catch (error) {
        console.error('üí• Error cr√≠tico en loadAgendaConfigFromSupabase:', error);
        console.error('Stack trace:', error.stack);
    }
}

   // Cargar turnos reservados - VERSI√ìN CORREGIDA
async function loadBookedSlotsFromSupabase() {
    if (!supabaseClient) {
        loadDemoData();
        return;
    }

    try {
        const today = new Date();
        const futureDate = new Date();
        futureDate.setDate(today.getDate() + 60);

        const { data, error } = await supabaseClient
            .from('turnos')
            .select('fecha, hora, estado')
            .gte('fecha', formatDate(today))
            .lte('fecha', formatDate(futureDate))
            .or('estado.eq.pendiente,estado.eq.confirmado,estado.eq.asistio');

        if (error) {
            console.error('Error Supabase turnos:', error);
            loadDemoData();
            return;
        }

        bookedSlots = {};
        if (data && data.length > 0) {
            data.forEach(turno => {
                if (turno.fecha && turno.hora) {
                    if (!bookedSlots[turno.fecha]) {
                        bookedSlots[turno.fecha] = [];
                    }
                    if (!bookedSlots[turno.fecha].includes(turno.hora)) {
                        bookedSlots[turno.fecha].push(turno.hora);
                    }
                }
            });
        }

        console.log('Turnos cargados:', Object.keys(bookedSlots).length, 'fechas con reservas');

    } catch (error) {
        console.error('Error cargando turnos:', error);
        loadDemoData();
    }
}

// Guardar reserva - VERSI√ìN CORREGIDA
async function saveReservationToSupabase(clientName, clientWhatsApp) {
    console.log('üíΩ saveReservationToSupabase - INICIANDO');
    
    // Si no hay Supabase, modo demo
    if (!supabaseClient) {
        console.log('üîÑ Usando modo demo');
        await new Promise(resolve => setTimeout(resolve, 800));
        return { 
            success: true, 
            data: { 
                id: 'demo-' + Date.now(),
                fecha: selectedDate,
                hora: selectedTime,
                servicio: selectedService
            } 
        };
    }
    
    try {
        const precio = servicePrices[selectedService] || 0;
        
        console.log('üí∞ Precio:', precio);
        
        // **SOLUCI√ìN: Usar fetch DIRECTAMENTE sin el SDK**
        // Esta es la forma m√°s segura de evitar problemas de cache del schema
        
        const reservationData = {
            fecha: selectedDate,
            hora: selectedTime,
            servicio: selectedService,
            nombre: clientName,
            telefono: clientWhatsApp,
            precio: precio,
            estado: 'pendiente'
            // NO incluir created_at - dejar que la base de datos use el DEFAULT
        };
        
        console.log('üì§ Datos a enviar:', reservationData);
        
        // URL CORRECTA para Supabase REST API
        const url = `${SUPABASE_URL}/rest/v1/turnos`;
        console.log('üåê URL:', url);
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                'Prefer': 'return=representation',
                // Headers importantes para evitar problemas
                'Cache-Control': 'no-cache',
                'Pragma': 'no-cache'
            },
            body: JSON.stringify([reservationData])  // IMPORTANTE: Array con un objeto
        });
        
        console.log('üì° Response status:', response.status, response.statusText);
        
        if (!response.ok) {
            let errorMessage = `Error HTTP ${response.status}`;
            try {
                const errorData = await response.json();
                console.error('‚ùå Error detallado:', errorData);
                errorMessage = errorData.message || errorMessage;
            } catch (e) {
                const errorText = await response.text();
                console.error('‚ùå Error texto:', errorText);
                errorMessage = errorText || errorMessage;
            }
            throw new Error(errorMessage);
        }
        
        const result = await response.json();
        console.log('‚úÖ RESPUESTA EXITOSA:', result);
        
        return { 
            success: true, 
            data: result[0] || reservationData 
        };
        
    } catch (error) {
        console.error('üí• ERROR CR√çTICO:', error);
        return { 
            success: false, 
            message: error.message || 'Error desconocido al guardar'
        };
    }
}

// Agrega esta funci√≥n y ll√°mala al inicio
async function verificarTablaTurnos() {
    if (!supabaseClient) return;
    
    console.log('üîç VERIFICANDO TABLA TURNOS...');
    
    try {
        // 1. Verificar si podemos consultar la tabla
        const { data, error } = await supabaseClient
            .from('turnos')
            .select('*')
            .limit(1);
        
        if (error) {
            console.error('‚ùå Error consultando turnos:', error);
            return;
        }
        
        console.log('‚úÖ Tabla turnos accesible');
        
        // 2. Verificar columnas con una consulta espec√≠fica
        const { data: columnas, error: errorColumnas } = await supabaseClient
            .from('turnos')
            .select('fecha, hora, servicio, nombre, telefono, precio, estado, created_at, id')
            .limit(1);
        
        if (errorColumnas) {
            console.error('‚ùå Error con columnas espec√≠ficas:', errorColumnas);
            
            // Intentar sin created_at
            const { data: sinCreatedAt, error: errorSinCreatedAt } = await supabaseClient
                .from('turnos')
                .select('fecha, hora, servicio, nombre, telefono, precio, estado, id')
                .limit(1);
            
            if (errorSinCreatedAt) {
                console.error('‚ùå Error incluso sin created_at:', errorSinCreatedAt);
            } else {
                console.log('‚úÖ Tabla funciona SIN created_at');
            }
        } else {
            console.log('‚úÖ Todas las columnas funcionan');
        }
        
    } catch (error) {
        console.error('üí• Error en verificaci√≥n:', error);
    }
}

// Agrega esta funci√≥n y ejec√∫tala en setupEventListeners
function debugConfirmButton() {
    const confirmBtn = document.getElementById('confirmReservationBtn');
    
    if (!confirmBtn) {
        console.error('‚ùå Bot√≥n confirmReservationBtn no encontrado en el DOM');
        return;
    }
    
    console.log('üîç Bot√≥n confirmReservationBtn encontrado');
    
    // Remover listeners anteriores (por si acaso)
    confirmBtn.removeEventListener('click', confirmReservation);
    
    // Agregar nuevo listener con logging
    confirmBtn.addEventListener('click', function(event) {
        console.log('üñ±Ô∏è Bot√≥n de confirmaci√≥n clickeado');
        console.log('üìç Evento:', event);
        console.log('üìç Bot√≥n:', this);
        
        // Verificar si hay un formulario
        const form = this.closest('form') || this.closest('.reservation-form');
        if (form) {
            console.log('üìã Formulario encontrado:', form);
        }
        
        confirmReservation();
    });
    
    // Tambi√©n agregar listener para tecla Enter en los inputs
    const inputs = ['clientName', 'clientWhatsApp'];
    inputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
            input.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    console.log('‚Üµ Enter presionado en', inputId);
                    event.preventDefault();
                    confirmReservation();
                }
            });
        }
    });
}

// Verificar estructura de la tabla turnos
async function checkTurnosStructure() {
    if (!supabaseClient) return;
    
    try {
        // Consulta simple para verificar columnas
        const { data, error } = await supabaseClient
            .from('turnos')
            .select('*')
            .limit(1);
            
        if (error) {
            console.error('Error verificando tabla turnos:', error);
            return;
        }
        
        if (data && data.length > 0) {
            console.log('Estructura de turnos:', Object.keys(data[0]));
        }
        
    } catch (error) {
        console.error('Error en checkTurnosStructure:', error);
    }
}

// REEMPLAZA tu funci√≥n initializeSupabase con esto:
async function initializeSupabase() {
    console.log('üîß Inicializando conexi√≥n...');
    
    // No usar el SDK de Supabase, solo fetch
    if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
        console.warn('‚ö†Ô∏è Modo demo - sin conexi√≥n real');
        loadDemoData();
        return;
    }
    
    console.log('‚úÖ Credenciales encontradas');
    
    // Intentar cargar datos usando fetch directamente
    await loadTurnosWithFetch();
    await loadServiciosWithFetch();
    await loadAgendaWithFetch();
    
    console.log('üéØ Datos cargados exitosamente');
}

// Funci√≥n para cargar turnos con fetch
async function loadTurnosWithFetch() {
    try {
        const hoy = new Date();
        const fechaDesde = formatDate(hoy);
        const fechaHasta = new Date();
        fechaHasta.setDate(hoy.getDate() + 60);
        
        const url = `${SUPABASE_URL}/rest/v1/turnos?fecha=gte.${fechaDesde}&fecha=lte.${formatDate(fechaHasta)}&estado=in.(pendiente,confirmado,asistio)&select=fecha,hora`;
        
        console.log('üì° Cargando turnos desde:', url);
        
        const response = await fetch(url, {
            headers: {
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            console.log(`‚úÖ ${data.length} turnos cargados`);
            
            bookedSlots = {};
            data.forEach(turno => {
                if (turno.fecha && turno.hora) {
                    if (!bookedSlots[turno.fecha]) {
                        bookedSlots[turno.fecha] = [];
                    }
                    bookedSlots[turno.fecha].push(turno.hora);
                }
            });
        } else {
            console.error('‚ùå Error cargando turnos:', await response.text());
            loadDemoData();
        }
    } catch (error) {
        console.error('üí• Error:', error);
        loadDemoData();
    }
}

// Cargar agenda - VERSI√ìN MEJORADA
async function loadAgendaConfigFromSupabase() {
    if (!supabaseClient) return;

    try {
        const hoy = new Date();
        const mesSiguiente = new Date();
        mesSiguiente.setDate(hoy.getDate() + 60);

        console.log('Cargando agenda desde:', formatDate(hoy), 'hasta:', formatDate(mesSiguiente));

        const { data, error } = await supabaseClient
            .from('horarios_agenda')
            .select('fecha, activo')
            .gte('fecha', formatDate(hoy))
            .lte('fecha', formatDate(mesSiguiente));

        if (error) {
            console.error('Error cargando agenda:', error);
            return;
        }

        console.log('Datos de agenda cargados:', data ? data.length : 0);

        if (data && data.length > 0) {
            data.forEach(item => {
                if (item.fecha && item.activo === false) {
                    const fechaKey = item.fecha;
                    if (!bookedSlots[fechaKey]) {
                        bookedSlots[fechaKey] = [];
                    }
                    // Bloquear todo el d√≠a
                    console.log('D√≠a bloqueado en agenda:', fechaKey);
                }
            });
        }

    } catch (error) {
        console.error('Error en loadAgendaConfigFromSupabase:', error);
    }
}

    // Datos de demostraci√≥n
    function loadDemoData() {
        console.log('Cargando datos demo');
        const exampleBookedSlots = {};
        const hoy = new Date();
        
        for (let i = 0; i < 10; i++) {
            const fecha = new Date();
            fecha.setDate(hoy.getDate() + i);
            const fechaStr = formatDate(fecha);
            
            if (Math.random() > 0.5) {
                exampleBookedSlots[fechaStr] = [];
                const horarios = ['09:00', '10:30', '14:00', '16:30'];
                const cantidad = Math.floor(Math.random() * 3) + 1;
                
                for (let j = 0; j < cantidad; j++) {
                    const horario = horarios[Math.floor(Math.random() * horarios.length)];
                    if (!exampleBookedSlots[fechaStr].includes(horario)) {
                        exampleBookedSlots[fechaStr].push(horario);
                    }
                }
            }
        }
        
        bookedSlots = exampleBookedSlots;
        showNotification('Modo demostraci√≥n', 'info');
    }

    // Inicializar calendario
    function initCalendar() {
        const now = new Date();
        currentMonth = now.getMonth();
        currentYear = now.getFullYear();
        renderCalendar(currentMonth, currentYear);
    }

    // Renderizar calendario
    function renderCalendar(month, year) {
        const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

        document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;

        const firstDay = new Date(year, month, 1);
        const startingDay = firstDay.getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        const calendarDates = document.getElementById('calendarDates');
        if (!calendarDates) return;
        calendarDates.innerHTML = '';

        for (let i = 0; i < startingDay; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.classList.add('calendar-date', 'disabled');
            calendarDates.appendChild(emptyDay);
        }

        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dateStr = formatDate(date);
            const dateElement = document.createElement('div');
            dateElement.classList.add('calendar-date');
            dateElement.textContent = day;
            dateElement.dataset.date = dateStr;

            if (date < today) {
                dateElement.classList.add('disabled');
            } else {
                if (selectedDate === dateStr) {
                    dateElement.classList.add('selected');
                }

                dateElement.addEventListener('click', function () {
                    selectDate(dateStr);
                });
            }

            calendarDates.appendChild(dateElement);
        }
    }

    // Configurar eventos
    function setupEventListeners() {
        // Navegaci√≥n
        const btnMainPage = document.getElementById('btnMainPage');
        const btnReservationPage = document.getElementById('btnReservationPage');

        if (btnMainPage) {
            btnMainPage.addEventListener('click', function () {
                showPage('mainPage');
                this.classList.add('active');
                if (btnReservationPage) btnReservationPage.classList.remove('active');
            });
        }

        if (btnReservationPage) {
            btnReservationPage.addEventListener('click', function () {
                showPage('reservationPage');
                this.classList.add('active');
                if (btnMainPage) btnMainPage.classList.remove('active');
            });
        }

        // Botones
        const goToReservationBtn = document.getElementById('goToReservationBtn');
        if (goToReservationBtn) {
            goToReservationBtn.addEventListener('click', function () {
                showPage('reservationPage');
                if (btnReservationPage) btnReservationPage.classList.add('active');
                if (btnMainPage) btnMainPage.classList.remove('active');
            });
        }

        const goToCalendarBtn = document.getElementById('goToCalendarBtn');
        if (goToCalendarBtn) {
            goToCalendarBtn.addEventListener('click', function () {
                showPage('reservationPage');
                if (btnReservationPage) btnReservationPage.classList.add('active');
                if (btnMainPage) btnMainPage.classList.remove('active');
                setTimeout(() => {
                    const scheduleSection = document.getElementById('schedule');
                    if (scheduleSection) scheduleSection.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            });
        }

        // Calendario
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');

        if (prevMonthBtn) {
            prevMonthBtn.addEventListener('click', function () {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar(currentMonth, currentYear);
            });
        }

        if (nextMonthBtn) {
            nextMonthBtn.addEventListener('click', function () {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar(currentMonth, currentYear);
            });
        }

        // Servicio
        const serviceSelect = document.getElementById('serviceSelect');
        if (serviceSelect) {
            serviceSelect.addEventListener('change', function () {
                selectedService = this.value;
                updateReservationSummary();
            });
        }

        // Confirmar reserva
       async function confirmReservation() {
    console.log('üéØ confirmReservation INICIADO');
    
    if (isSaving) return;
    
    // Obtener datos
    const clientName = document.getElementById('clientName')?.value.trim() || '';
    const clientWhatsApp = document.getElementById('clientWhatsApp')?.value.trim() || '';
    
    // Validaciones simples
    if (clientName.length < 2) {
        showNotification('Ingresa tu nombre', 'error');
        return;
    }
    
    if (clientWhatsApp.length < 8) {
        showNotification('Ingresa tu WhatsApp', 'error');
        return;
    }
    
    if (!selectedDate || !selectedTime || !selectedService) {
        showNotification('Completa fecha, hora y servicio', 'error');
        return;
    }
    
    // Cambiar estado
    isSaving = true;
    const btn = document.getElementById('confirmReservationBtn');
    if (btn) btn.disabled = true;
    
    try {
        console.log('üíæ Intentando guardar...');
        
        // Usar la NUEVA funci√≥n
        const result = await saveReservationToSupabase(clientName, clientWhatsApp);
        
        console.log('üìã Resultado:', result);
        
        if (result.success) {
            // Actualizar slots locales
            if (!bookedSlots[selectedDate]) {
                bookedSlots[selectedDate] = [];
            }
            bookedSlots[selectedDate].push(selectedTime);
            
            // Mostrar modal de √©xito
            showConfirmationModal(clientName, clientWhatsApp, result.data);
            showNotification('¬°Reserva confirmada!', 'success');
            
            // Actualizar UI
            updateAvailableHours();
        } else {
            throw new Error(result.message || 'Error al guardar');
        }
        
    } catch (error) {
        console.error('‚ùå Error final:', error);
        showNotification(error.message || 'Error al guardar', 'error');
    } finally {
        // Restaurar bot√≥n
        isSaving = false;
        const btn = document.getElementById('confirmReservationBtn');
        if (btn) btn.disabled = false;
    }
}}

    // Mostrar p√°gina
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });

        const pageElement = document.getElementById(pageId);
        if (pageElement) {
            pageElement.classList.add('active');
        }

        if (pageId === 'reservationPage') {
            updateAvailableHours();
            updateReservationSummary();
        }
    }

    // Seleccionar fecha
    function selectDate(dateStr) {
        selectedDate = dateStr;

        document.querySelectorAll('.calendar-date').forEach(el => {
            el.classList.remove('selected');
            if (el.dataset.date === dateStr) {
                el.classList.add('selected');
            }
        });

        const dateObj = parseDate(dateStr);
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const selectedDateText = document.getElementById('selectedDateText');
        if (selectedDateText) {
            selectedDateText.textContent = `Turnos disponibles para el ${dateObj.toLocaleDateString('es-ES', options)}`;
        }

        updateAvailableHours();
        updateReservationSummary();

        if (selectedTime) {
            scrollToReservationForm();
        }
    }

    // Seleccionar hora
    function selectTime(timeStr) {
        selectedTime = timeStr;

        document.querySelectorAll('.hour-option').forEach(el => {
            el.classList.remove('selected');
            if (el.dataset.time === timeStr) {
                el.classList.add('selected');
            }
        });

        updateReservationSummary();

        if (selectedDate) {
            scrollToReservationForm();
        }
    }

    // Scroll al formulario
    function scrollToReservationForm() {
        setTimeout(() => {
            const reservationSection = document.getElementById('reservation');
            if (reservationSection) {
                reservationSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }, 300);
    }

    // Actualizar horas disponibles
    function updateAvailableHours() {
        const hoursList = document.getElementById('hoursList');
        if (!hoursList) return;

        hoursList.innerHTML = '';

        if (!selectedDate) {
            hoursList.innerHTML = '<p style="color: #aaa; text-align: center; padding: 20px;">Selecciona una fecha</p>';
            return;
        }

        const startHour = 9;
        const endHour = 18;
        const bookedForDate = bookedSlots[selectedDate] || [];
        let hasAvailableHours = false;

        for (let hour = startHour; hour <= endHour; hour++) {
            for (let minute = 0; minute < 60; minute += 30) {
                const dateObj = parseDate(selectedDate);
                const isSaturday = dateObj.getDay() === 6;
                if (isSaturday && hour >= 16 && minute > 0) break;

                const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                const isBooked = bookedForDate.includes(timeStr);

                const timeElement = document.createElement('div');
                timeElement.classList.add('hour-option');
                timeElement.dataset.time = timeStr;
                timeElement.textContent = timeStr;

                if (isBooked) {
                    timeElement.classList.add('disabled');
                    timeElement.title = 'Horario reservado';
                } else {
                    hasAvailableHours = true;
                    timeElement.addEventListener('click', function () {
                        if (!this.classList.contains('disabled')) {
                            selectTime(timeStr);
                        }
                    });
                }

                hoursList.appendChild(timeElement);
            }
        }

        if (!hasAvailableHours) {
            hoursList.innerHTML = '<p style="color: #aaa; text-align: center; padding: 20px;">No hay horarios disponibles</p>';
        }
    }

    // Actualizar resumen
    function updateReservationSummary() {
        const summaryDate = document.getElementById('summaryDate');
        const summaryTime = document.getElementById('summaryTime');
        const summaryService = document.getElementById('summaryService');
        const summaryPrice = document.getElementById('summaryPrice');

        if (summaryDate) {
            summaryDate.textContent = selectedDate
                ? formatDateForDisplay(parseDate(selectedDate))
                : 'No seleccionada';
        }

        if (summaryTime) {
            summaryTime.textContent = selectedTime || 'No seleccionada';
        }

        if (summaryService) {
            summaryService.textContent = selectedService || 'No seleccionado';
        }

        let price = 0;
        if (selectedService && servicePrices[selectedService]) {
            price = servicePrices[selectedService];
        }

        if (summaryPrice) {
            summaryPrice.textContent = `$${price.toLocaleString('es-AR')}`;
        }
    }

    // Confirmar reserva
   async function confirmReservation() {
    console.log('üü° confirmReservation llamado');
    
    if (isSaving) {
        console.log('‚ö†Ô∏è Ya se est√° guardando, ignorando clic');
        return;
    }

    // Obtener valores de los inputs
    const clientName = document.getElementById('clientName')?.value.trim();
    const clientWhatsApp = document.getElementById('clientWhatsApp')?.value.trim();
    
    console.log('üìù Datos del formulario:', {
        nombre: clientName,
        whatsapp: clientWhatsApp,
        fecha: selectedDate,
        hora: selectedTime,
        servicio: selectedService
    });

    // Validaciones mejoradas
    if (!clientName || clientName.length < 2) {
        console.error('‚ùå Nombre inv√°lido:', clientName);
        showNotification('Ingresa tu nombre (m√≠nimo 2 caracteres)', 'error');
        return;
    }

    if (!clientWhatsApp || clientWhatsApp.length < 8) {
        console.error('‚ùå WhatsApp inv√°lido:', clientWhatsApp);
        showNotification('Ingresa un n√∫mero de WhatsApp v√°lido', 'error');
        return;
    }

    if (!selectedDate) {
        console.error('‚ùå Fecha no seleccionada');
        showNotification('Selecciona una fecha', 'error');
        return;
    }

    if (!selectedTime) {
        console.error('‚ùå Hora no seleccionada');
        showNotification('Selecciona una hora', 'error');
        return;
    }

    if (!selectedService) {
        console.error('‚ùå Servicio no seleccionado');
        showNotification('Selecciona un servicio', 'error');
        return;
    }

    // Verificar si el horario ya est√° reservado
    const bookedForDate = bookedSlots[selectedDate] || [];
    if (bookedForDate.includes(selectedTime)) {
        console.error('‚ùå Horario ya reservado:', selectedDate, selectedTime);
        showNotification('Este horario ya est√° reservado. Por favor selecciona otro.', 'error');
        updateAvailableHours();
        return;
    }

    // Cambiar estado a "guardando"
    isSaving = true;
    const confirmBtn = document.getElementById('confirmReservationBtn');
    const confirmText = document.getElementById('confirmText');

    if (confirmBtn) {
        confirmBtn.disabled = true;
        confirmBtn.style.opacity = '0.7';
        confirmBtn.style.cursor = 'not-allowed';
    }
    
    if (confirmText) {
        confirmText.innerHTML = '<span class="loading"></span> Guardando reserva...';
    }

    console.log('üíæ Guardando reserva...');

    try {
        const result = await saveReservationToSupabase(clientName, clientWhatsApp);

        console.log('üìä Resultado del guardado:', result);

        if (!result.success) {
            throw new Error(result.message || 'Error desconocido al guardar la reserva');
        }

        // Actualizar slots reservados localmente
        if (!bookedSlots[selectedDate]) {
            bookedSlots[selectedDate] = [];
        }
        bookedSlots[selectedDate].push(selectedTime);
        
        console.log('‚úÖ Slots actualizados:', bookedSlots[selectedDate]);

        // Mostrar modal de confirmaci√≥n
        showConfirmationModal(clientName, clientWhatsApp, result.data);
        
        // Mostrar notificaci√≥n de √©xito
        showNotification('¬°Reserva guardada exitosamente!', 'success');
        
        // Actualizar la vista de horas disponibles
        updateAvailableHours();

    } catch (error) {
        console.error('‚ùå Error en confirmReservation:', error);
        
        let errorMessage = 'Error al guardar la reserva';
        if (error.message.includes('duplicate key') || error.message.includes('ya existe')) {
            errorMessage = 'Este turno ya est√° reservado. Por favor selecciona otro horario.';
        } else if (error.message.includes('network') || error.message.includes('fetch')) {
            errorMessage = 'Error de conexi√≥n. Verifica tu internet e intenta nuevamente.';
        } else if (error.message.includes('RLS')) {
            errorMessage = 'Error de permisos. Contacta al administrador.';
        }
        
        showNotification(errorMessage, 'error');
        
        // Recargar datos para sincronizar
        await loadBookedSlotsFromSupabase();
        updateAvailableHours();
        
    } finally {
        // Restaurar estado del bot√≥n
        isSaving = false;
        
        if (confirmBtn) {
            confirmBtn.disabled = false;
            confirmBtn.style.opacity = '1';
            confirmBtn.style.cursor = 'pointer';
        }
        
        if (confirmText) {
            confirmText.textContent = 'Confirmar Reserva';
        }
        
        console.log('üîÑ Estado restaurado');
    }
}

// Agrega esta funci√≥n para testear
async function testSupabaseDirect() {
    console.log('üß™ TEST SUPABASE DIRECTO');
    
    // Test GET primero
    try {
        const testUrl = 'https://wumhmurhneptjeptqmwo.supabase.co/rest/v1/turnos?select=*&limit=1';
        console.log('üîç Probando GET:', testUrl);
        
        const getResponse = await fetch(testUrl, {
            headers: {
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
            }
        });
        
        console.log('GET Status:', getResponse.status);
        if (getResponse.ok) {
            const data = await getResponse.json();
            console.log('üìä Datos existentes:', data);
        } else {
            const error = await getResponse.text();
            console.error('‚ùå GET Error:', error);
        }
    } catch (e) {
        console.error('üí• GET Exception:', e);
    }
}

// Llama a esta funci√≥n desde la consola: testSupabaseDirect()

    // Guardar en Supabase
 // Funci√≥n saveReservationToSupabase con nombres CORREGIDOS
async function saveReservationToSupabase(clientName, clientWhatsApp) {
    console.log('üíæ Guardando reserva...');
    
    const precio = servicePrices[selectedService] || 0;
    
    // Datos con nombres de columnas CORRECTOS seg√∫n tu tabla
    const datos = {
        fecha: selectedDate,
        hora: selectedTime,
        servicio: selectedService,
        cliente_nombre: clientName,        // Cambiado de 'nombre' a 'cliente_nombre'
        cliente_telefono: clientWhatsApp,  // Cambiado de 'telefono' a 'cliente_telefono'
        precio: precio,
        estado: 'pendiente'
    };
    
    console.log('üì§ Enviando con nombres correctos:', datos);
    
    try {
        const respuesta = await fetch('https://wumhmurhneptjeptqmwo.supabase.co/rest/v1/turnos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                'Prefer': 'return=representation'
            },
            body: JSON.stringify([datos])
        });
        
        console.log('üì° Estado:', respuesta.status);
        
        if (respuesta.ok) {
            const resultado = await respuesta.json();
            console.log('‚úÖ √âxito:', resultado);
            return { success: true, data: resultado[0] };
        } else {
            const error = await respuesta.text();
            console.error('‚ùå Error:', error);
            return { success: false, message: 'Error al guardar' };
        }
        
    } catch (error) {
        console.error('üí• Error de conexi√≥n:', error);
        return { success: false, message: 'Error de conexi√≥n' };
    }
}

// Agrega esta funci√≥n para diagnosticar
async function descubrirEstructuraTabla() {
    console.log('üîç DESCUBRIENDO ESTRUCTURA DE TABLA...');
    
    try {
        // Intentar consultar la tabla sin columnas espec√≠ficas
        const response = await fetch('https://wumhmurhneptjeptqmwo.supabase.co/rest/v1/turnos?limit=1', {
            headers: {
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            if (data && data.length > 0) {
                console.log('üìä ESTRUCTURA DESCUBIERTA:');
                const primerRegistro = data[0];
                Object.keys(primerRegistro).forEach(key => {
                    console.log(`  - ${key}: ${primerRegistro[key]} (${typeof primerRegistro[key]})`);
                });
                
                // Sugerir mapeo
                console.log('\nüéØ SUGERENCIA DE MAPEO:');
                console.log('  nombre ‚Üí', Object.keys(primerRegistro).find(k => k.includes('nombre') || k.includes('name')) || 'NO ENCONTRADO');
                console.log('  telefono ‚Üí', Object.keys(primerRegistro).find(k => k.includes('tel') || k.includes('phone')) || 'NO ENCONTRADO');
            } else {
                console.log('üì≠ La tabla est√° vac√≠a');
            }
        } else {
            console.error('‚ùå Error:', await response.text());
        }
    } catch (error) {
        console.error('üí• Error:', error);
    }
}

// Ejecuta desde la consola: descubrirEstructuraTabla()

    // Mostrar modal de confirmaci√≥n
    function showConfirmationModal(clientName, clientWhatsApp, reservationData = null) {
        const modalClientName = document.getElementById('modalClientName');
        const modalWhatsApp = document.getElementById('modalWhatsApp');
        const modalDate = document.getElementById('modalDate');
        const modalTime = document.getElementById('modalTime');
        const modalService = document.getElementById('modalService');
        const modalPrice = document.getElementById('modalPrice');
        const modalStatus = document.getElementById('modalStatus');

        if (modalClientName) modalClientName.textContent = clientName;
        if (modalWhatsApp) modalWhatsApp.textContent = clientWhatsApp;
        if (modalDate) modalDate.textContent = formatDateForDisplay(parseDate(selectedDate));
        if (modalTime) modalTime.textContent = selectedTime;
        if (modalService) modalService.textContent = selectedService;
        
        const price = servicePrices[selectedService] || 0;
        if (modalPrice) modalPrice.textContent = `$${price.toLocaleString('es-AR')}`;

        if (modalStatus) {
            if (reservationData && reservationData.id) {
                modalStatus.innerHTML = `Pendiente (ID: ${reservationData.id})`;
            } else {
                modalStatus.textContent = 'Pendiente de confirmaci√≥n';
            }
        }

        const formattedDate = formatDateForDisplay(parseDate(selectedDate));
        const whatsappMessage = `Hola Alexis, soy ${clientName}. Quiero confirmar mi reserva en A.S. Studio:%0A%0AüìÖ Fecha: ${formattedDate}%0A‚è∞ Hora: ${selectedTime}%0A‚úÇÔ∏è Servicio: ${selectedService}%0Aüí∞ Total: $${price.toLocaleString('es-AR')}%0A%0AMi WhatsApp: ${clientWhatsApp}%0A%0A¬øEst√° disponible este horario?`;
        const whatsappNumber = '54911155739203';

        const whatsappLink = document.getElementById('whatsappLink');
        if (whatsappLink) {
            whatsappLink.href = `https://wa.me/${whatsappNumber}?text=${whatsappMessage}`;
            const plainMessage = `Hola Alexis, soy ${clientName}. Quiero confirmar mi reserva en A.S. Studio:\n\nüìÖ Fecha: ${formattedDate}\n‚è∞ Hora: ${selectedTime}\n‚úÇÔ∏è Servicio: ${selectedService}\nüí∞ Total: $${price.toLocaleString('es-AR')}\n\nMi WhatsApp: ${clientWhatsApp}\n\n¬øEst√° disponible este horario?`;
            whatsappLink.dataset.message = plainMessage;
        }

        const confirmationModal = document.getElementById('confirmationModal');
        if (confirmationModal) {
            confirmationModal.classList.add('active');
        }
    }

    // Copiar mensaje
    function copyMessageToClipboard() {
        const whatsappLink = document.getElementById('whatsappLink');
        if (!whatsappLink || !whatsappLink.dataset.message) {
            showNotification('No hay mensaje', 'error');
            return;
        }

        const message = whatsappLink.dataset.message;
        const tempElement = document.createElement('textarea');
        tempElement.value = message;
        document.body.appendChild(tempElement);
        tempElement.select();
        tempElement.setSelectionRange(0, 99999);

        try {
            const successful = document.execCommand('copy');
            showNotification(successful ? 'Copiado' : 'Error', successful ? 'success' : 'error');
        } catch (err) {
            showNotification('Error al copiar', 'error');
        }

        document.body.removeChild(tempElement);
    }

    // Cerrar modal
    function closeModal() {
        const confirmationModal = document.getElementById('confirmationModal');
        if (confirmationModal) {
            confirmationModal.classList.remove('active');
        }
        resetForm();
    }

    // Enviar reporte
    async function sendReport() {
        const problemDescription = document.getElementById('problemDescription');
        if (!problemDescription) return;

        const description = problemDescription.value.trim();

        if (!description) {
            showNotification('Describe el problema', 'error');
            return;
        }

        if (supabaseClient) {
            try {
                const { error } = await supabaseClient
                    .from('reportes_problemas')
                    .insert([
                        {
                            descripcion: description,
                            fecha: new Date().toISOString().split('T')[0],
                            creado_en: new Date().toISOString()
                        }
                    ]);

                if (error) throw error;

                showNotification('Reporte enviado', 'success');

            } catch (error) {
                console.error('Error reporte:', error);
                showNotification('Error al enviar', 'error');
            }
        } else {
            showNotification('Reporte simulado', 'success');
        }

        problemDescription.value = '';

        const reportForm = document.getElementById('reportForm');
        if (reportForm) {
            reportForm.classList.remove('active');
        }
    }

    // Mostrar notificaci√≥n
    function showNotification(message, type = 'info') {
        const notification = document.getElementById('notification');
        if (!notification) return;

        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.style.display = 'block';

        setTimeout(() => {
            notification.style.display = 'none';
        }, 5000);
    }

    // Resetear formulario
    function resetForm() {
        selectedDate = null;
        selectedTime = null;
        selectedService = null;

        const clientName = document.getElementById('clientName');
        const clientWhatsApp = document.getElementById('clientWhatsApp');
        const serviceSelect = document.getElementById('serviceSelect');

        if (clientName) clientName.value = '';
        if (clientWhatsApp) clientWhatsApp.value = '';
        if (serviceSelect) serviceSelect.value = '';

        document.querySelectorAll('.calendar-date.selected').forEach(el => {
            el.classList.remove('selected');
        });

        document.querySelectorAll('.hour-option.selected').forEach(el => {
            el.classList.remove('selected');
        });

        updateReservationSummary();
        updateAvailableHours();
    }

    // Agrega esta funci√≥n y ll√°mala despu√©s de inicializar Supabase
async function diagnosticarSupabase() {
    if (!supabaseClient) {
        console.log('‚ùå Cliente Supabase no inicializado');
        return;
    }
    
    console.log('üîç INICIANDO DIAGN√ìSTICO SUPABASE');
    
    try {
        // 1. Verificar conexi√≥n b√°sica
        console.log('1. Verificando conexi√≥n...');
        const { data: testData, error: testError } = await supabaseClient
            .from('servicios')
            .select('count')
            .limit(1);
            
        if (testError) {
            console.error('‚ùå Error de conexi√≥n:', testError);
        } else {
            console.log('‚úÖ Conexi√≥n OK');
        }
        
        // 2. Verificar tabla horarios_agenda
        console.log('2. Verificando tabla horarios_agenda...');
        const { data: agendaData, error: agendaError } = await supabaseClient
            .from('horarios_agenda')
            .select('*')
            .limit(5);
            
        if (agendaError) {
            console.error('‚ùå Error accediendo horarios_agenda:', agendaError);
        } else {
            console.log(`‚úÖ Tabla horarios_agenda OK. ${agendaData ? agendaData.length : 0} registros encontrados`);
            if (agendaData && agendaData.length > 0) {
                console.log('Muestra de datos:', agendaData);
            }
        }
        
        // 3. Verificar tabla turnos
        console.log('3. Verificando tabla turnos...');
        const hoy = new Date();
        const { data: turnosData, error: turnosError } = await supabaseClient
            .from('turnos')
            .select('fecha, hora, estado')
            .gte('fecha', formatDate(hoy))
            .limit(10);
            
        if (turnosError) {
            console.error('‚ùå Error accediendo turnos:', turnosError);
        } else {
            console.log(`‚úÖ Tabla turnos OK. ${turnosData ? turnosData.length : 0} turnos futuros encontrados`);
        }
        
    } catch (error) {
        console.error('üí• Error en diagn√≥stico:', error);
    }
    
    console.log('üîç FIN DIAGN√ìSTICO');
}

 // VERSI√ìN MEJORADA - formatDate
function formatDate(date) {
    if (!(date instanceof Date) || isNaN(date)) {
        console.error('‚ùå Error: fecha inv√°lida en formatDate:', date);
        return '2000-01-01'; // Fecha por defecto segura
    }
    
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    
    const resultado = `${year}-${month}-${day}`;
    console.log('üìÖ formatDate:', date, '‚Üí', resultado);
    return resultado;
}

    function parseDate(dateStr) {
        const [year, month, day] = dateStr.split('-').map(Number);
        return new Date(year, month - 1, day);
    }

    function formatDateForDisplay(date) {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        return date.toLocaleDateString('es-ES', options);
    }
</script>
 </body>

</html>
